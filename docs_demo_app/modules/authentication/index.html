<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>@knora/authentication | Knora-ui module</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="./images/favicon.ico">
	      <link rel="stylesheet" href="./styles/style.css">
        <link rel="stylesheet" href="./styles/material.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="./" class="navbar-brand">@knora/authentication | Knora-ui module</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content getting-started">
                   <div class="content-data">

<h1 id="knora-ui">Knora-ui</h1>
<p><a href="https://circleci.com/gh/dhlab-basel/Knora-ui"><img src="https://circleci.com/gh/dhlab-basel/Knora-ui.svg?style=svg" alt="CircleCI" class="img-responsive"></a>
<a href="https://travis-ci.com/dhlab-basel/Knora-ui"><img src="https://travis-ci.com/dhlab-basel/Knora-ui.svg?branch=develop" alt="Build Status" class="img-responsive"></a></p>
<p>This is the demo and developing environment for Knora ui modules.</p>
<p>The modules helps to create a graphical user interface for <a href="https://knora.org">Knora</a> in a quick and simple way. They&#39;re written in <a href="https://angular.io">Angular</a> (v6) including the <a href="https://material.angular.io">material design</a>.</p>
<p>Knora itself is a software framework for storing, sharing, and working with primary sources and data in the humanities.</p>
<p>It is developed by the <a href="http://dhlab.unibas.ch/">Digital Humanities Lab</a> at the <a href="https://unibas.ch/en.html">University of Basel</a>, and is supported by the <a href="http://www.sagw.ch/en/sagw.html">Swiss Academy of Humanities and Social Sciences</a>.</p>
<p>Knora and the Knora ui elements is <a href="http://www.gnu.org/philosophy/free-sw.en.html">free software</a>, released under the <a href="http://www.gnu.org/licenses/agpl-3.0.en.html">GNU Affero General Public License</a>.</p>
<h2 id="already-published-modules">Already published modules</h2>
<h3 id="-knora-core">@knora/core</h3>
<p><img src="https://img.shields.io/npm/v/@knora/core.svg" alt="npm (scoped)" class="img-responsive"> </p>
<p>The core module contains every service to use Knora&#39;s RESTful webapi.</p>
<h3 id="-knora-authentication">@knora/authentication</h3>
<p><img src="https://img.shields.io/npm/v/@knora/authentication.svg" alt="npm (scoped)" class="img-responsive"></p>
<p>The authentication module contains the login form (for standalone usage) or a complete login- / logout-button environment incl. the login form.</p>
<h3 id="-knora-search">@knora/search</h3>
<p><img src="https://img.shields.io/npm/v/@knora/search.svg" alt="npm (scoped)" class="img-responsive"></p>
<p>Search module allows to make simple searches or extended searches in Knora. In extended search, resource class and its properties related to one specific ontology are selected to create your query.</p>
<h3 id="-knora-viewer">@knora/viewer</h3>
<p><img src="https://img.shields.io/npm/v/@knora/viewer.svg" alt="npm (scoped)" class="img-responsive"></p>
<p>The viewer module contains object components to show the resource class representations from Knora, the gui-elements for the property values and different kind of view frameworks.</p>
<h3 id="-knora-action">@knora/action</h3>
<p><img src="https://img.shields.io/npm/v/@knora/action.svg" alt="npm (scoped)" class="img-responsive"></p>
<p>The action module contains special buttons (e.g. to sort a list), pipes and directives.</p>
<h2 id="developers-note">Developers note</h2>
<p>Good news: Angular 6 has a built-in <a href="https://github.com/angular/angular-cli/wiki/stories-create-library">library support</a>. Previous we built the library with the following setup:</p>
<p>We used <a href="https://github.com/dherges/ng-packagr">ng-packagr</a> by following the <a href="https://github.com/dherges/ng-packaged">ng-packaged</a>-example and this tutorial: <a href="https://medium.com/@nikolasleblanc/building-an-angular-4-component-library-with-the-angular-cli-and-ng-packagr-53b2ade0701e">https://medium.com/@nikolasleblanc/building-an-angular-4-component-library-with-the-angular-cli-and-ng-packagr-53b2ade0701e</a></p>
<p>Now we can create a library module quite easy. Please use the following command schema:</p>
<p><code>$ ng generate library @knora/[module-name] --prefix=kui</code></p>
<p>If you want to add more components, services and so on to this library, you can do it with:</p>
<p><code>$ ng generate component [path/in/your/module/][name-of-component] --project @knora/[module-name]</code></p>
<p>It puts the component or the service into <code>lib/</code> directly. Otherwise you can define a path inside of <code>lib/</code>.</p>
<h3 id="install-the-demo-app">Install the demo app</h3>
<div><pre class="line-numbers"><code class="language-none">$ cd knora-ui

$ yarn install --prod=false

$ rm -rf dist/&#64;knora
$ yarn build-lib</code></pre></div><p>The demo app runs on <a href="http://localhost:4200">http://localhost:4200</a> and we use it on this repository&#39;s <a href="https://dhlab-basel.github.io/Knora-ui">Github page</a></p>
<h3 id="developing-modules">Developing modules</h3>
<p>To create new e.g. component inside existing module use the following command:</p>
<p><code>$ ng g c [component-name] --project @knora/[module-name] --styleext scss</code></p>
<hr>
<h2 id="knora-module-structure">Knora module structure</h2>
<p>@knora/core</p>
<!-- ![npm (scoped)](https://img.shields.io/npm/v/@knora/core.svg) -->
<ul>
<li>services (for API requests)</li>
<li>constants &amp; utils (to work with Knora)</li>
</ul>
<p>@knora/action</p>
<!-- ![npm (scoped)](https://img.shields.io/npm/v/@knora/action.svg) -->
<ul>
<li>buttons &amp; buttons</li>
<li>progress-indicator</li>
<li>progress-stepper</li>
<li>message</li>
<li>directives &amp; pipes</li>
<li>dialog</li>
</ul>
<p>@knora/authentication</p>
<!-- ![npm (scoped)](https://img.shields.io/npm/v/@knora/authentication.svg) -->
<ul>
<li>login</li>
<li>logout</li>
</ul>
<p>@knora/search</p>
<!-- ![npm (scoped)](https://img.shields.io/npm/v/@knora/search.svg) -->
<ul>
<li>search results</li>
<li>search panel incl. search action (like adding a collection)</li>
</ul>
<p>@knora/viewer</p>
<!-- ![npm (scoped)](https://img.shields.io/npm/v/@knora/viewer.svg) -->
<ul>
<li>object viewer (incl. video, audio, image)</li>
<li>properties (as form elements)</li>
<li>resource_class_form</li>
</ul>
<!-- ---

## Unit Testing Services

Testing services with HttpClient and HttpTestingController

* Then a test expects that certain requests have or have not been made, performs assertions against those requests, and finally provide responses by "flushing" each expected request.
https://angular.io/guide/http#testing-http-requests
* See https://stackblitz.com/edit/angular-uy5cdl?file=src%2Fapp%2Fheroes%2Fheroes.service.spec.ts for a working example.

 ```TypeScript
 getAllHeroes (): Observable<any[]> {
    const observables = [];

    for (let i = 0; i <= 2; i++) {
      observables.push(
        this.http.get<Hero[]>(this.heroesUrl)
        .pipe(
          catchError(this.handleError('getAllHeroes', []))
      )
      );
    }

    return forkJoin(observables);

  }
  ``` 

* Several http requests are created and pushed on an array, then they are passed to forkJoin and returned. With forkJoin, we get one Observable that we can subscribe to (executed once all Observables have been completed). Then we get the results of all Observables from within the subscription to the Observable returned by forkJoin.

```TypeScript
 it('should get all heroes', () => {

      let res = heroService.getAllHeroes();   

      res.subscribe(
        (obs) => { 

          console.log("test")

          expect(obs[0]).toEqual(expectedHeroes, 'should return expected heroes');
          expect(obs[1]).toEqual(expectedHeroes, 'should return expected heroes');
          expect(obs[2]).toEqual(expectedHeroes, 'should return expected heroes');
        }, fail
      );

      // HeroService should have made three requests to GET heroes from expected URL
      const req = httpTestingController.match(
        (request) => {
          return request.url === heroService.heroesUrl && request.method === 'GET'
        }
      );

      // Respond with the mock heroes
      expect(req.length).toEqual(3);

      req[0].flush(expectedHeroes)
      req[1].flush(expectedHeroes)
      req[2].flush(expectedHeroes)

    });
```

* The clue is that for each http request made, a response has to be "flushed". Otherwise the subscription to the Observable returned by forkJoin is never executed:
If an inner observable does not complete forkJoin will never emit a value!
https://www.learnrxjs.io/operators/combination/forkjoin.html

> This is why the subscription never worked, because we did not flush all necessary responses. -->


















                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 0;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'getting-started';
            var COMPODOC_CURRENT_PAGE_URL = 'index.html';
       </script>

       <script src="./js/libs/custom-elements.min.js"></script>
       <script src="./js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="./js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="./js/menu-wc.js" defer></script>

       <script src="./js/libs/bootstrap-native.js"></script>

       <script src="./js/libs/es6-shim.min.js"></script>
       <script src="./js/libs/EventDispatcher.js"></script>
       <script src="./js/libs/promise.min.js"></script>
       <script src="./js/libs/zepto.min.js"></script>

       <script src="./js/compodoc.js"></script>

       <script src="./js/tabs.js"></script>
       <script src="./js/menu.js"></script>
       <script src="./js/libs/clipboard.min.js"></script>
       <script src="./js/libs/prism.js"></script>
       <script src="./js/sourceCode.js"></script>
          <script src="./js/search/search.js"></script>
          <script src="./js/search/lunr.min.js"></script>
          <script src="./js/search/search-lunr.js"></script>
          <script src="./js/search/search_index.js"></script>
       <script src="./js/lazy-load-graphs.js"></script>


    </body>
</html>
